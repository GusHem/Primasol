<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prima Sol - Offertverktyg</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Animationer */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }

        /* Utskriftsanpassning */
        @media print {
            body { background: white; }
            #main-layout { display: block; }
            #config-panel, #ai-panel, #header-controls, .no-print { display: none !important; }
            #quote-section { width: 100%; border: none; shadow: none; }
            #quote-items { overflow: visible; height: auto; }
            header { border-bottom: 2px solid #000; margin-bottom: 20px; }
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex flex-col text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm">
        <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
            <div class="flex items-center gap-6">
                <!-- KUNDLOGGA -->
                <div class="h-12 w-auto">
                    <img src="https://raw.githubusercontent.com/GusHem/Primasol/refs/heads/main/Prima%20Sol%20As%20Logga%202.svg" alt="Prima Sol As" class="h-full object-contain">
                </div>
                <div class="h-8 w-px bg-slate-200 hidden md:block"></div>
                <div>
                    <h1 class="text-sm font-bold text-slate-900 uppercase tracking-wider">Offertverktyg</h1>
                    <p class="text-xs text-slate-500">Neva & Screen Prislistor</p>
                </div>
            </div>
            
            <div id="header-controls" class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <p class="text-xs text-slate-400">Inloggad</p>
                    <p class="text-sm font-medium text-slate-700">Säljare</p>
                </div>
                <div class="bg-slate-100 p-2 rounded-full text-slate-500 border border-slate-200">
                    <i class="fa-solid fa-user"></i>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-6 flex-grow w-full">
        <div id="main-layout" class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-[calc(100vh-8rem)]">

            <!-- VÄNSTER: Konfigurator (5 kolumner) -->
            <div id="config-panel" class="lg:col-span-5 flex flex-col gap-6 overflow-y-auto custom-scroll pr-2 pb-10">
                
                <!-- 1. Produktval -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="bg-slate-800 px-5 py-3 flex justify-between items-center">
                        <h2 class="text-white font-semibold text-sm flex items-center gap-2">
                            <i class="fa-solid fa-gear"></i> 1. Konfigurera Produkt
                        </h2>
                    </div>
                    
                    <div class="p-5 space-y-5">
                        
                        <!-- Katalog -->
                        <div>
                            <label class="text-xs font-bold text-slate-500 uppercase mb-2 block">Katalog</label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="cursor-pointer relative">
                                    <input type="radio" name="vendor" value="screen_2025" class="peer sr-only" checked>
                                    <div class="py-2.5 px-3 text-center rounded-lg border border-slate-200 text-sm font-medium text-slate-600 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:border-blue-600 peer-checked:text-blue-700 peer-checked:shadow-sm transition-all">
                                        Hansen Screen
                                    </div>
                                </label>
                                <label class="cursor-pointer relative">
                                    <input type="radio" name="vendor" value="neva_2023" class="peer sr-only">
                                    <div class="py-2.5 px-3 text-center rounded-lg border border-slate-200 text-sm font-medium text-slate-600 hover:bg-slate-50 peer-checked:bg-orange-50 peer-checked:border-orange-600 peer-checked:text-orange-700 peer-checked:shadow-sm transition-all">
                                        Neva Persienner
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Dropdowns -->
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase block mb-1">Produktfamilj</label>
                                <div class="relative">
                                    <select id="category" class="w-full p-2.5 bg-slate-50 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition cursor-pointer appearance-none">
                                        <!-- JS fyller -->
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
                                        <i class="fa-solid fa-chevron-down text-xs"></i>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-500 uppercase block mb-1">Modell</label>
                                <div class="relative">
                                    <select id="product" class="w-full p-2.5 bg-slate-50 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition cursor-pointer disabled:opacity-50 disabled:bg-slate-100" disabled>
                                        <option>-- Välj familj --</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
                                        <i class="fa-solid fa-chevron-down text-xs"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mått -->
                        <div class="bg-blue-50 rounded-lg border border-blue-100 p-4">
                            <div class="flex justify-between mb-2">
                                <label class="text-xs font-bold text-blue-800 uppercase">Dimensioner (cm)</label>
                                <span id="dim-limits" class="text-[10px] text-blue-600 bg-white px-2 rounded-full border border-blue-200 hidden"></span>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="relative">
                                    <span class="absolute left-3 top-2.5 text-blue-400 text-xs font-bold">B</span>
                                    <input type="number" id="width" class="w-full pl-8 p-2 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 outline-none font-mono font-bold text-slate-700" placeholder="Bredd">
                                </div>
                                <div class="relative">
                                    <span class="absolute left-3 top-2.5 text-blue-400 text-xs font-bold">H</span>
                                    <input type="number" id="height" class="w-full pl-8 p-2 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 outline-none font-mono font-bold text-slate-700" placeholder="Höjd">
                                </div>
                            </div>
                        </div>

                        <!-- BERÄKNA KNAPP -->
                        <button id="calculate-btn" class="w-full bg-white border-2 border-slate-800 text-slate-800 hover:bg-slate-50 font-bold py-3 px-4 rounded-lg shadow-sm transition flex items-center justify-center gap-2">
                            <i class="fa-solid fa-calculator"></i> Beräkna Styckpris
                        </button>
                        
                        <div id="error-msg" class="hidden text-xs text-red-600 font-medium bg-red-50 p-3 rounded-lg border border-red-100 flex items-center gap-2">
                            <i class="fa-solid fa-triangle-exclamation"></i> <span id="error-text"></span>
                        </div>

                    </div>
                </div>

                <!-- 2. RESULTAT & LÄGG TILL (Visas efter beräkning) -->
                <div id="add-panel" class="bg-white rounded-xl shadow-md border border-green-200 overflow-hidden hidden transition-all duration-500 transform translate-y-4 opacity-0">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-5 border-b border-green-100">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-xs text-green-700 font-bold uppercase tracking-wide">Beräknat Styckpris</p>
                                <div class="flex items-baseline gap-1">
                                    <span id="display-price" class="text-3xl font-black text-slate-900">0</span>
                                    <span class="text-sm font-bold text-slate-500">NOK</span>
                                </div>
                            </div>
                            <div class="text-right text-xs text-slate-500">
                                <p>Tabellmatchning:</p>
                                <p id="display-dims" class="font-mono font-bold">--</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-5 bg-white">
                        <div class="flex items-end gap-4">
                            <div class="flex-1">
                                <label class="text-xs font-bold text-slate-500 uppercase mb-1 block">Antal</label>
                                <div class="flex items-center h-10">
                                    <button onclick="changeQty(-1)" class="h-full px-3 bg-slate-100 border border-r-0 border-slate-300 rounded-l hover:bg-slate-200 text-slate-600 font-bold">-</button>
                                    <input type="number" id="quantity" value="1" min="1" class="h-full w-full border-y border-slate-300 outline-none text-center font-bold text-slate-800">
                                    <button onclick="changeQty(1)" class="h-full px-3 bg-slate-100 border border-l-0 border-slate-300 rounded-r hover:bg-slate-200 text-slate-600 font-bold">+</button>
                                </div>
                            </div>
                            <button id="add-to-quote-btn" class="flex-[2] h-10 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-md shadow-green-200 transition flex items-center justify-center gap-2">
                                <i class="fa-solid fa-cart-plus"></i> Lägg till i Offert
                            </button>
                        </div>
                    </div>
                </div>

                <!-- AI (Kompakt) -->
                <div class="bg-indigo-50 rounded-xl border border-indigo-100 p-4 flex items-start gap-3">
                    <div class="bg-white p-2 rounded-full text-indigo-600 shadow-sm flex-shrink-0">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-sm font-bold text-indigo-900">Produktassistent</h3>
                        <div class="flex gap-2 mt-2">
                            <input type="text" id="ai-input" class="w-full text-xs p-2 rounded border border-indigo-200 focus:ring-1 focus:ring-indigo-500 outline-none" placeholder="Fråga om tex RS Smart XL...">
                            <button onclick="handleChat()" class="bg-indigo-600 text-white px-3 py-1 rounded text-xs hover:bg-indigo-700 transition">Fråga</button>
                        </div>
                        <div id="ai-response" class="hidden mt-2 text-xs text-slate-700 bg-white p-2 rounded border border-indigo-100 shadow-sm leading-relaxed"></div>
                    </div>
                </div>

            </div>

            <!-- HÖGER: Offertöversikt / Varukorg (7 kolumner) -->
            <div id="quote-section" class="lg:col-span-7 bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col h-full min-h-[600px]">
                
                <!-- Quote Header -->
                <div class="px-6 py-4 border-b border-slate-200 bg-slate-50/80 rounded-t-2xl flex justify-between items-center">
                    <div>
                        <h2 class="font-bold text-slate-800 text-lg flex items-center gap-2">
                            <i class="fa-solid fa-file-invoice text-slate-400"></i> Aktuell Offert
                        </h2>
                        <div class="text-[10px] text-slate-500 mt-1 flex gap-3">
                            <span>Datum: <span id="current-date" class="font-medium text-slate-700"></span></span>
                            <span class="w-px h-3 bg-slate-300"></span>
                            <span>Ref: <span id="ref-id" class="font-medium text-slate-700"></span></span>
                        </div>
                    </div>
                    <span id="quote-count" class="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-1 rounded-full">0 artiklar</span>
                </div>

                <!-- Table Header -->
                <div class="grid grid-cols-12 gap-2 px-6 py-2 bg-slate-100 text-[10px] font-bold text-slate-500 uppercase tracking-wider border-b border-slate-200">
                    <div class="col-span-5">Produktbeskrivning</div>
                    <div class="col-span-2 text-center">Mått (cm)</div>
                    <div class="col-span-2 text-center">Antal</div>
                    <div class="col-span-2 text-right">Belopp</div>
                    <div class="col-span-1"></div>
                </div>

                <!-- Quote Items -->
                <div id="quote-items" class="flex-1 overflow-y-auto custom-scroll p-2 space-y-1 bg-white">
                    <!-- Empty State -->
                    <div id="empty-state" class="flex flex-col items-center justify-center h-full text-slate-300">
                        <i class="fa-solid fa-cart-arrow-down text-5xl mb-3 opacity-20"></i>
                        <p class="text-sm font-medium">Listan är tom</p>
                        <p class="text-xs">Gör en beräkning till vänster för att börja</p>
                    </div>
                </div>

                <!-- Quote Footer -->
                <div class="p-6 bg-slate-50 border-t border-slate-200 rounded-b-2xl">
                    <div class="flex flex-col items-end gap-1 mb-6">
                        <div class="text-sm text-slate-500 font-medium">Totalt Netto (exkl. motor)</div>
                        <div class="text-4xl font-black text-slate-900 tracking-tight" id="total-price">0 NOK</div>
                    </div>
                    
                    <div class="flex gap-3 justify-end no-print">
                        <button onclick="clearQuote()" class="px-4 py-2.5 text-sm text-red-600 font-semibold hover:bg-red-50 rounded-lg transition">
                            Rensa
                        </button>
                        <button onclick="window.print()" class="px-6 py-2.5 bg-slate-900 text-white text-sm font-bold rounded-lg hover:bg-slate-800 transition shadow-lg flex items-center gap-2">
                            <i class="fa-solid fa-print"></i> Exportera PDF / Skriv ut
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // --- DATABAS ---
        const database = {
            "screen_2025": {
                "name": "Hansen Screen",
                "unit": "cm",
                "currency": "NOK",
                "categories": {
                    "RS Classic": {
                        "RS Classic 75": { base: 2154, stepW: 100, stepH: 100, factor: 1.04, range: {minW: 60, maxW: 280, minH: 60, maxH: 300} },
                        "RS Classic 85": { base: 2213, stepW: 100, stepH: 100, factor: 1.04, range: {minW: 60, maxW: 400, minH: 60, maxH: 350} },
                        "RS Classic 95": { base: 2301, stepW: 100, stepH: 100, factor: 1.05, range: {minW: 60, maxW: 450, minH: 60, maxH: 400} },
                        "RS Classic 105": { base: 2550, stepW: 100, stepH: 100, factor: 1.05, range: {minW: 70, maxW: 450, minH: 60, maxH: 400} },
                        "RS Classic 120": { base: 2693, stepW: 100, stepH: 100, factor: 1.06, range: {minW: 80, maxW: 500, minH: 80, maxH: 450} },
                        "RS Classic 125": { base: 2693, stepW: 100, stepH: 100, factor: 1.06, range: {minW: 80, maxW: 500, minH: 80, maxH: 450} }
                    },
                    "Mini ZIP": {
                        "Mini ZIP": { base: 2482, stepW: 100, stepH: 100, factor: 1.035, range: {minW: 60, maxW: 300, minH: 60, maxH: 300} }
                    },
                    "RS Universal": {
                        "RS Universal 85": { base: 2475, stepW: 100, stepH: 100, factor: 1.045, range: {minW: 60, maxW: 400, minH: 60, maxH: 350} },
                        "RS Universal 95": { base: 2535, stepW: 100, stepH: 100, factor: 1.05, range: {minW: 60, maxW: 450, minH: 60, maxH: 400} },
                        "RS Universal 105": { base: 2715, stepW: 100, stepH: 100, factor: 1.055, range: {minW: 70, maxW: 450, minH: 60, maxH: 400} },
                        "RS Universal 120": { base: 2790, stepW: 100, stepH: 100, factor: 1.06, range: {minW: 80, maxW: 500, minH: 80, maxH: 450} },
                        "RS Universal 125": { base: 2790, stepW: 100, stepH: 100, factor: 1.06, range: {minW: 80, maxW: 500, minH: 80, maxH: 450} }
                    },
                    "RS Smart": {
                        "RS Smart 85": { base: 2715, stepW: 100, stepH: 100, factor: 1.05, range: {minW: 60, maxW: 400, minH: 60, maxH: 350} },
                        "RS Smart 100": { base: 3030, stepW: 100, stepH: 100, factor: 1.055, range: {minW: 70, maxW: 450, minH: 60, maxH: 400} },
                        "RS Smart 130": { base: 3480, stepW: 100, stepH: 100, factor: 1.06, range: {minW: 80, maxW: 500, minH: 80, maxH: 450} },
                        "RS Smart 130 XL": { base: 14448, stepW: 610, stepH: 100, factor: 1.015, range: {minW: 401, maxW: 600, minH: 100, maxH: 600} }
                    }
                }
            },
            "neva_2023": {
                "name": "Neva Utvendig",
                "unit": "mm", 
                "currency": "NOK",
                "categories": {
                    "Utvendige Persienner": {
                        "C80 / F80": { base: 2410, stepW: 700, stepH: 700, factor: 1.04, range: {minW: 60, maxW: 500, minH: 60, maxH: 500} },
                    }
                }
            }
        };

        // Matrisdata för exakta priser (Alternativ A)
        const priceMatrices = {
            // RS Smart 100
            "RS Smart 100": {
                w: [100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400],
                h: [100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350],
                prices: [
                    [3030,3165,3330,3495,3675,3825,4020,4170,4350,4485,4650,4800,4980,5130,5295,5460,5610,5775,5925,6090,6255,6420,6585,6750,6930,7095,7245,7410,7560,7740,7890],
                    [3150,3315,3495,3675,3825,4005,4170,4350,4485,4650,4815,4995,5145,5340,5490,5670,5820,6015,6150,6315,6495,6645,6810,6975,7170,7320,7485,7635,7830,7980,8145],
                    [3300,3465,3660,3810,4005,4140,4350,4485,4680,4815,5025,5160,5355,5505,5700,5865,6045,6195,6390,6540,6720,6870,7080,7230,7410,7560,7770,7905,8111,8250,8445],
                    [3435,3630,3795,3975,4125,4320,4485,4650,4815,5025,5175,5355,5520,5715,5895,6060,6240,6420,6585,6765,6945,7140,7310,7455,7635,7815,7980,8160,8355,8520,8685],
                    [3540,3750,3900,4095,4305,4455,4650,4815,5025,5175,5370,5535,5715,5895,6075,6255,6435,6615,6795,6975,7170,7335,7515,7725,7890,8070,8250,8445,8595,8775,8970],
                    [3705,3870,4065,4230,4440,4635,4800,4995,5160,5355,5535,5730,5910,6090,6270,6465,6630,6825,7035,7200,7380,7560,7770,7950,8130,8325,8505,8655,8865,9060,9240],
                    [3840,4035,4215,4410,4575,4785,4980,5145,5355,5520,5730,5910,6090,6300,6495,6645,6855,7050,7245,7425,7605,7815,7980,8160,8370,8550,8745,8940,9120,9300,9510],
                    [4005,4170,4380,4545,4755,4950,5130,5340,5505,5715,5895,6090,6300,6495,6690,6855,7080,7260,7440,7635,7830,8010,8235,8430,8610,8790,9000,9195,9360,9600,9780],
                    [4095,4320,4500,4725,4905,5100,5290,5490,5700,5895,6075,6270,6495,6690,6870,7095,7260,7455,7665,7875,8070,8250,8460,8640,8865,9060,9255,9435,9645,9840,10020],
                    [4230,4440,4650,4830,5055,5250,5460,5670,5865,6060,6255,6465,6645,6870,7095,7275,7485,7695,7890,8145,8340,8505,8685,8895,9105,9285,9510,9705,9900,10095,10305],
                    [4395,4575,4785,5025,5205,5415,5610,5850,6045,6240,6435,6645,6855,7080,7260,7485,7695,7890,8130,8325,8520,8700,8925,9150,9330,9555,9735,9960,10185,10365,10575],
                    [4530,4740,4935,5145,5355,5550,5775,6015,6195,6420,6615,6825,7050,7260,7455,7695,7890,8100,8325,8535,8730,8970,9165,9360,9600,9795,9990,10215,10410,10620,10875],
                    [4650,4860,5100,5295,5505,5730,5925,6150,6390,6600,6795,7035,7245,7440,7665,7890,8100,8325,8535,8745,8970,9180,9375,9615,9825,10020,10260,10470,10680,10920,11100],
                    [4785,5025,5235,5460,5685,5895,6105,6315,6540,6765,6975,7200,7425,7635,7875,8120,8325,8535,8745,8985,9180,9375,9630,9840,10035,10290,10515,10710,10950,11130,11385],
                    [4935,5145,5370,5595,5820,6060,6270,6510,6720,6945,7170,7380,7605,7860,8070,8280,8520,8730,8970,9180,9420,9645,9855,10065,10305,10530,10725,10995,11205,11430,11655],
                    [5085,5295,5505,5760,5970,6195,6435,6645,6870,7140,7335,7590,7815,8010,8265,8505,8700,8970,9180,9375,9645,9855,10065,10335,10545,10785,11010,11235,11490,11685,11910],
                    [5175,5430,5670,5895,6135,6375,6600,6810,7080,7305,7515,7785,7980,8235,8460,8685,8940,9165,9375,9630,9855,10095,10335,10560,10785,11025,11250,11505,11730,11955,12210],
                    [5340,5550,5820,6045,6270,6525,6765,6690,7230,7455,7725,7950,8175,8430,8640,8895,9150,9360,9615,9840,10065,10335,10560,10785,11025,11265,11520,11745,11970,12225,12435],
                    [5475,5715,5955,6195,6435,6690,6930,7170,7410,7635,7890,8130,8370,8610,8865,9105,9330,9600,9825,10035,10305,10545,10785,11025,11265,11520,11745,12000,12240,12465,12720],
                    [5610,5865,6090,6345,6600,6825,7095,7320,7590,7830,8070,8325,8550,8805,9060,9285,9555,9810,10020,10290,10530,10785,11025,11265,11520,11760,12015,12255,12510,12750,12975],
                    [5730,6015,6240,6510,6750,6690,7245,7500,7770,7980,8250,8505,8745,9000,9255,9510,9780,9990,10275,10515,10740,11010,11265,11520,11745,12015,12255,12525,12750,13020,13275],
                    [6645,6960,7245,7545,7815,8100,8415,8685,8985,9255,9555,9825,10110,10395,10695,10995,11280,11565,11850,12150,12420,12720,13020,13305,13575,13875,14160,14430,14730,15015,15315],
                    [6720,7035,7305,7605,7890,8160,8460,8745,9030,9300,9615,9885,10200,10470,10740,11025,11310,11625,11910,12210,12510,12765,13065,13335,13635,13920,14190,14460,14775,15015,15420],
                    [6855,7170,7440,7770,8010,8340,8610,8925,9195,9465,9795,10035,10365,10635,10950,11235,11550,11820,12150,12405,12720,12990,13305,13605,13875,14175,14430,14760,15015,15330,15630],
                    [6990,7305,7590,7890,8160,8505,8775,9090,9345,9660,9960,10260,10545,10875,11145,11430,11730,12030,12345,12615,12945,13230,13530,13800,14100,14400,14700,15000,15300,15615,15870],
                    [7140,7440,7740,8055,8340,8625,8940,9140,9555,9825,10155,10410,10725,11025,11325,11640,11955,12240,12555,12855,13140,13455,13755,14040,14340,14640,14940,15270,15540,15855,16170]
                ]
            },
            // Neva C80/F80
            "C80 / F80": {
                 w: [600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000,2100,2200,2300,2400,2500,2600,2700,2800,2900,3000,3100,3200,3300,3400,3500,3600,3700,3800,3900,4000,4100,4200,4300,4400,4500,4600,4700,4800,4900,5000],
                 h: [600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000,2100,2200,2300,2400,2500,2600,2700,2800,2900,3000,3100,3200,3300,3400,3500,3600,3700,3800,3900,4000,4100,4200,4300,4400,4500,4600,4700,4800,4900,5000],
                 prices: [
                    [2410,2450,2500,2530,2570,2610,2650,2730,2690,2790,2830,2880,2920,3040,2960,3000,3230,3080,3120,3180,3270,3310,3350,3790,3840,3880,3920,3970,4070,4020,4120,4150,4200,4240,4280,4370,4330,4410,4530,4490,4580,4620,4670,4710,4750],
                    [2480,2500,2540,2580,2640,2680,2730,2770,2810,2890,2930,2990,3030,3070,3120,3100,3220,3260,3300,3380,3420,3520,3470,3900,4000,4040,4100,4140,4240,4280,4340,4380,4440,4480,4530,4580,4630,4700,4680,4810,4800,4910,4900,5000,5050],
                    [2510,2540,2590,2640,2650,2740,2790,2890,2840,2960,3020,3130,3070,3280,3230,3180,3430,3380,3320,3510,3560,3580,3620,4190,4250,4310,4340,4470,4570,4630,4650,4710,4800,4850,4910,4970,5020,5080,5200,5320,5380,5440,5400,5500,5550],
                    [2550,2580,2640,2690,2750,2810,2870,2920,2980,3060,3120,3180,3040,3290,3390,3400,3470,3520,3680,3580,3720,3770,3840,4370,4430,4480,4590,4680,4610,4850,4910,4870,5040,5090,5240,5310,5370,5440,5550,5610,5670,5730,5800,5860,5910],
                    [2580,2630,2680,2750,2810,2870,2930,3050,2990,3140,3200,3340,3270,3480,3300,3520,3640,3600,3790,3710,3920,3800,3980,4570,4630,4710,4780,4840,5020,5000,5240,5320,5280,5370,5510,5530,5600,5740,5850,5870,5930,6070,6140,6210,6280],
                    [2610,2670,2740,2800,2870,2930,3010,3140,3070,3240,3300,3440,3380,3580,3640,3610,3710,3950,3850,3780,4080,4010,4150,4700,4840,4900,5070,5230,5350,5430,5500,5680,5600,5730,5890,5820,5900,5970,6050,6170,6250,6320,6400,6460,6540],
                    [2650,2710,2780,2830,2900,3000,3070,3220,3140,3310,3380,3540,3470,3760,3880,3610,4080,3970,3900,3830,4230,4150,4290,5020,4950,5190,5260,5380,5440,5570,5680,5730,5820,5910,5990,6060,6160,6230,6320,6450,6530,6700,6780,6870,6950],
                    [2680,2700,2830,2910,2990,3090,3150,3300,3230,3410,3490,3650,3560,3690,3730,3880,4200,4120,4030,3900,4380,4310,4470,5230,5320,5410,5520,5680,5890,5960,6090,6000,6180,6270,6350,6440,6630,6770,6840,6960,7040,7030,7120,7220,7300],
                    [2710,2740,2840,2900,3020,3110,3220,3370,3290,3490,3560,3720,3630,3770,3990,4040,4380,4290,4210,4530,4530,4450,4610,5440,5504,5640,5720,5820,5920,6070,6180,6260,6350,6450,6550,6640,6740,6990,7070,6830,7270,7170,7470,7370,7560],
                    [2740,2800,2890,2960,3040,3130,3200,3440,3350,3500,3660,3760,3710,3880,4040,4100,4460,4430,4450,4610,4700,4620,4770,5620,5720,5820,6080,6130,6290,6360,6460,6560,6630,6790,6830,6900,7000,7100,7260,7380,7480,7580,7680,7780,7870],
                    [2770,2840,2900,3020,3110,3190,3300,3490,3410,3620,3700,3800,3790,3900,4140,4210,4510,4510,4590,4730,4890,4730,4930,5830,5940,6050,6200,6360,6530,6640,6750,6880,6970,7070,7130,7180,7290,7400,7510,7670,7780,7890,7820,7910,8010],
                    [2800,2890,2980,3070,3160,3220,3370,3540,3460,3660,3770,3880,3870,3950,4230,4300,4640,4570,4730,4890,4950,4850,4980,6040,6150,6270,6330,6500,6610,6780,6800,7010,7130,7240,7390,7470,7500,7700,7820,7860,7910,8010,8120,8220,8320],
                    [2830,2900,3020,3040,3130,3290,3440,3590,3520,3660,3830,3910,3950,4080,4290,4380,4700,4710,4800,4930,5060,5020,5140,6220,6340,6480,6580,6700,6820,7000,7120,7240,7350,7480,7600,7730,7850,7780,7890,8060,8100,8150,8260,8310,8410],
                    [2860,2960,3070,3110,3190,3350,3490,3630,3570,3700,3900,3990,4030,4240,4380,4510,4820,4830,4920,5050,5230,5170,5290,6420,6550,6680,6800,6930,7090,7250,7380,7500,7630,7750,7880,7830,7940,8060,8100,8340,8460,8570,8690,8800,8920],
                    [2900,3020,3110,3160,3200,3280,3530,3660,3700,3760,3830,4040,4120,4290,4430,4540,4890,4940,5000,5210,5330,5330,5400,6630,6770,6900,7030,7160,7300,7500,7630,7760,7890,7850,7970,8060,8210,8330,8450,8620,8560,8730,8940,9050,9150],
                    [2930,3070,3130,3190,3220,3300,3560,3700,3750,3800,3910,4080,4210,4380,4510,4640,4990,5000,5170,5320,5440,5590,5710,6810,6950,7100,7240,7370,7510,7720,7860,7820,7940,8060,8180,8320,8400,8570,8680,8690,8880,8830,8950,9070,9190],
                    [2960,3120,3160,3200,3260,3370,3610,3760,3820,3880,3950,4120,4290,4430,4610,4710,5050,5210,5320,5450,5560,5610,5880,7020,7170,7310,7460,7610,7760,7760,7910,8040,8160,8310,8440,8570,8700,8830,9050,9240,9360,9480,9610,9740,9860],
                    [2990,3140,3190,3220,3300,3470,3660,3800,3880,3990,4030,4170,4380,4510,4670,4830,5100,5320,5400,5570,5740,5740,5880,7230,7380,7530,7680,7840,7900,8010,8150,8250,8430,8560,8700,8930,9050,9170,9320,9520,9680,9780,9970,10100,10340],
                    [3020,3180,3200,3350,3440,3540,3700,3830,3910,4040,4120,4210,4430,4640,4710,4920,5180,5400,5600,5780,5810,5880,6190,7410,7580,7730,7880,7880,8000,8210,8350,8490,8630,8770,8920,9150,9290,9420,9550,9780,9900,10030,10220,10450,10580],
                    [3040,3190,3220,3370,3490,3640,3760,3880,3950,4100,4140,4240,4510,4730,4850,4990,5340,5570,5770,5810,6050,6000,6340,7620,7760,7920,7990,8140,8280,8440,8580,8730,8870,9100,9250,9460,9600,9740,9890,10060,10240,10380,10610,10820,10970],
                    [3070,3200,3300,3440,3540,3690,3800,3990,4030,4140,4230,4300,4530,4770,4990,5050,5520,5770,5810,6190,6200,6300,6510,7830,7970,8120,8260,8380,8560,8700,8840,9080,9220,9340,9490,9710,9880,10010,10220,10450,10610,10750,10980,11120,11270],
                    [3110,3220,3350,3490,3660,3770,3880,4030,4120,4240,4380,4510,4640,4850,5100,5240,5730,5910,6300,6350,6340,6440,6700,7980,8140,8270,8420,8540,8760,8910,9060,9250,9410,9560,9770,10000,10160,10390,10540,10700,10850,11000,11150,11380,11500],
                    [3130,3300,3440,3500,3660,3800,3910,4080,4210,4290,4430,4510,4670,4890,5120,5300,5770,6140,6330,6510,6500,6650,6910,8200,8350,8510,8650,8750,8920,9170,9320,9480,9640,9800,10020,10260,10600,10850,10810,10970,11130,11280,11450,11780,11920],
                    [3160,3370,3490,3610,3760,3830,3990,4140,4240,4330,4450,4640,4730,4930,5200,5340,5840,6220,6410,6530,6700,6790,7030,8360,8520,8700,8880,8970,9220,9380,9600,9770,9930,10080,10280,10660,10780,10920,11090,11250,11410,11650,11820,12070,12200],
                    [3190,3470,3540,3660,3800,3910,4030,4230,4290,4430,4540,4770,4890,5020,5220,5420,6090,6230,6450,6700,6820,7000,7220,8450,8630,8810,8950,9230,9410,9570,9800,10050,10220,10470,10730,10900,11060,11200,11400,11600,11880,12070,12240,12460,12580],
                    [3220,3500,3690,3770,3880,3990,4120,4300,4380,4530,4610,4800,4980,5130,5240,5450,6270,6340,6700,6820,7000,7150,7370,8640,8820,9000,9270,9440,9680,9850,10000,10260,10540,10710,10980,11150,11300,11560,11750,11920,12190,12350,12540,12710,12880],
                    [3250,3540,3700,3880,3950,4120,4240,4380,4510,4540,4770,4890,5000,5140,5300,5500,6340,6580,6850,7000,7310,7300,7530,8830,9010,9290,9460,9650,9890,10070,10250,10500,10780,10950,11230,11400,11690,12020,11850,12210,12470,12650,12830,13090,13280],
                    [3290,3580,3760,3910,4030,4210,4310,4430,4640,4730,4920,5050,5240,5280,5320,5600,6440,6710,6940,7110,7200,7490,7670,9000,9330,9470,9700,9850,10040,10310,10570,10750,10930,11190,11380,11640,11830,12010,12190,12460,12630,12820,13000,13180,13360],
                    [3320,3610,3800,3950,4140,4290,4430,4510,4770,4930,5050,5100,5300,5430,5620,5650,6500,6790,7120,7220,7440,7680,7880,9280,9630,9710,9910,10080,10300,10560,10750,11030,11220,11410,11680,11970,12350,12350,12540,12730,13000,13280,13470,13860,14050],
                    [3350,3660,3830,3990,4230,4380,4510,4640,4850,4990,5100,5320,5440,5570,5770,5910,6580,6880,7240,7260,7540,7880,8060,9520,9710,9910,10100,10300,10500,10780,10980,11200,11400,11740,12000,12220,12420,12610,12810,13090,13370,13570,13960,14100,14380],
                    [3380,3710,3880,4040,4300,4510,4640,4730,4930,5100,5300,5400,5600,5770,5910,6090,6790,7140,7430,7520,7670,8060,8430,9680,9880,10060,10200,10500,10770,10970,11170,11470,11750,11950,12240,12450,12640,12840,13130,13330,13630,13820,14220,14610,14700],
                    [3440,3770,3910,4120,4380,4640,4850,4990,5180,5240,5440,5620,5710,5910,6100,6270,6820,7190,7500,7750,7880,8250,8540,9880,10070,10380,10580,10770,10980,11108,11300,11770,11980,12190,12490,12700,12910,13200,13500,13810,14100,14310,14610,14810,15020],
                    [3470,3820,3950,4140,4510,4770,4930,5120,5290,5410,5550,5770,5840,6020,6200,6330,7000,7250,7630,7900,8070,8430,8650,9830,10040,10330,10540,10750,10950,11170,11407,11700,11970,12180,12408,12600,12900,13100,13310,13620,13820,14030,14340,14540,14850],
                    [3490,3880,3990,4210,4640,4890,5010,5180,5320,5450,5620,5800,5980,6090,6300,6440,7130,7300,7760,8000,8200,8510,8790,10000,10210,10510,10730,10930,11150,11370,11600,11970,12190,12390,12700,12920,13120,13340,13560,13770,14070,14290,14510,14720,14930]
                ]
            },
            "RS Classic 95": {
                w: [100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350],
                h: [100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350],
                prices: [
                    [2301,2375,2478,2581,2685,2773,2921,3024,3098,3230,3304,3437,3570,3643,3820,4056,4307,4484,4705,5045,5384,5679,5826,6151,6313,6667],
                    [2375,2493,2581,2699,2832,2935,3053,3127,3260,3393,3481,3629,3747,3835,3983,4278,4425,4617,4779,5118,5460,5753,5915,6239,6402,6757],
                    [2493,2581,2699,2832,2950,3068,3186,3289,3407,3511,3629,3747,3820,3997,4145,4425,4573,4705,4853,5207,5546,5856,6003,6357,6520,6870],
                    [2581,2699,2832,2950,3068,3216,3304,3437,3584,3688,3791,3938,4027,282,4337,4573,4853,5118,5399,5428,5694,5989,6151,6505,6682,7040],
                    [2699,2832,3068,3216,3304,3452,3452,3599,3702,3820,3968,4248,4366,4469,4705,4853,5015,5163,5605,5590,5856,6151,6298,6647,6829,7198],
                    [2803,2950,3186,3304,3452,3614,3614,3732,3835,3983,4115,4381,4233,4705,4897,5015,5207,5310,5753,5694,6003,6298,6451,6804,7006,7305],
                    [2935,3053,2950,3083,3216,3304,3747,3879,3997,4130,4278,4101,4499,4469,5059,5207,5399,5428,5974,5826,6166,6451,6593,6962,7139,7513],
                    [3039,3157,3289,3437,3599,3747,3879,4012,4145,4307,4425,4573,4705,4337,5251,5384,5576,5590,6195,6092,6387,6593,6711,7135,7301,7733],
                    [3127,3275,3422,3599,3732,3835,4012,4145,4307,4405,4602,4735,4897,4897,5399,5576,5767,5753,6048,6387,6475,6711,6859,7308,7419,7922],
                    [3452,3407,3776,3953,4101,3997,4145,4602,4455,4912,4912,5207,5384,5045,5576,5871,5915,5871,6387,6239,6313,6859,7021,7466,7655,7812],
                    [3378,3481,3658,3806,3983,4130,4307,4425,4602,4602,4735,4897,5236,5576,5694,5753,6033,6003,6579,6298,6608,7021,7139,7639,7985,8159],
                    [3245,3629,3570,3702,3820,4307,4425,4307,4735,4735,5059,5059,5045,5384,5856,6003,6195,6151,6844,6579,8068,7360,7360,7812,8237,8363],
                    [3688,3835,4012,4174,4351,4381,4573,4868,4897,5207,5369,5517,5679,5236,6003,6357,6387,6298,6863,5826,6874,7139,7567,8363,8489,8726],
                    [3599,3747,3909,4071,4248,4514,4705,4720,5045,5059,5207,5369,5546,5826,6166,6166,6534,6431,7006,6092,7036,7567,6151,8505,8710,8930],
                    [3791,3983,4130,4322,4484,4676,4853,5015,5192,5369,5517,5664,5826,5679,6475,6520,6682,6579,7154,6387,7154,6298,6451,8867,9104],
                    [3909,4174,4366,4573,4735,4794,5000,5310,5340,5664,5812,5974,5989,5989,6313,6815,6829,6844,7316,6298,7375,6451,6593,8710,8946],
                    [4012,4071,4278,4425,4617,4941,5118,5163,5458,5517,5664,5812,6151,6298,6608,6667,7006,6863,7478,6579,7596,6593,6711,8993,9119],
                    [4115,4322,4484,4691,4868,5059,5266,5428,5635,5812,5974,6136,6298,6151,8068,6977,7139,7006,7139,6697,6874,6711,6859,8363,9308],
                    [4248,4425,4617,4794,5015,5207,5399,5590,5782,5974,6136,6284,6451,6451,6874,7124,7301,7154,7493,7006,7036,6859,7021,8584,9513],
                    [4337,4514,4720,4941,5118,5325,5546,5753,5944,6136,6284,6431,6593,6593,7036,7287,7419,7316,7670,7124,7154,7021,7139,8789,9702],
                    [4455,4661,4853,5059,5266,5443,5679,5871,6062,6284,6431,6579,6711,6711,7154,7390,7655,7478,7139,7331,7375,7360,7360,8993,9891],
                    [4573,4750,4971,5192,5384,5590,5812,6003,6210,6431,6579,6697,6859,6859,7375,6667,6883,7478,7493,6844,7596,7567,7567,9167,9860],
                    [4676,4897,5074,5325,5517,5723,5959,6151,6357,6579,6697,6844,7021,7021,7596,6977,6993,7478,7670,7124,6874,7139,7139,9450,10112],
                    [4897,5118,5207,5428,5635,5974,6239,6431,6490,6844,7006,7006,7360,7360,7596,7124,7308,7478,7670,7331,7596,7567,7567,9214,10395],
                    [4779,5015,5325,5590,5782,5826,6092,6298,6638,6697,6844,7124,7139,7139,7596,7287,7560,7478,7670,7331,7596,7567,7567,9450,10663],
                    [5015,5251,5428,5694,5915,6092,6387,6579,6756,7006,7124,7331,7567,7360,7596,7390,7844,7478,7670,7331,7596,7567,7567,9450,10663]
                ]
            },
            // Mini ZIP - Matris (Bredd x Höjd)
            "Mini ZIP": {
                 w: [100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 330, 320, 340],
                 h: [100, 110, 120, 130, 140, 150, 160, 170],
                 prices: [
                    [2482, 2635, 2720, 2856, 2958, 3077, 3179, 3315, 3465, 3570, 3705, 3855, 4095, 4200, 4440, 4560, 4650, 4770, 4875, 5025, 5130, 5250, 5490, 5370, 5610],
                    [2635, 2737, 2856, 2975, 3094, 3196, 3366, 3485, 3645, 3750, 3870, 4065, 4305, 4410, 4635, 4755, 4860, 5025, 5130, 5250, 5370, 5490, 5730, 5610, 5865],
                    [2720, 2856, 2975, 3111, 3230, 3383, 3519, 3604, 3810, 3900, 4065, 4230, 4440, 4500, 4815, 4980, 5100, 5235, 5355, 5490, 5610, 5730, 5970, 5865, 6090],
                    [2856, 2975, 3111, 3230, 3383, 3519, 3638, 3774, 3975, 4095, 4230, 4440, 4650, 4725, 5055, 5175, 5325, 5460, 5595, 5715, 5865, 6015, 6270, 6135, 6420],
                    [2958, 3094, 3230, 3383, 3536, 3672, 3791, 3961, 4140, 4305, 4410, 4650, 4830, 4905, 5280, 5400, 5520, 5685, 5820, 5955, 6100, 6240, 6525, 6390, 6645],
                    [3077, 3196, 3383, 3519, 3672, 3791, 3961, 4131, 4320, 4440, 4575, 4830, 4995, 5130, 5475, 5610, 5760, 5895, 6060, 6195, 6345, 6495, 6865, 6615, 6900],
                    [3179, 3366, 3519, 3638, 3791, 3961, 4131, 4284, 4485, 4635, 4770, 5055, 5175, 5340, 5700, 5850, 5970, 6135, 6270, 6420, 6585, 6750, 7080, 6900, 7230],
                    [3315, 3485, 3604, 3774, 3961, 4131, 4284, 4454, 4650, 4800, 4950, 5250, 5400, 5520, 5895, 6060, 6195, 6375, 6510, 6645, 6795, 6945, 7230, 7095, 7365]
                 ]
            },
            // RS Smart 130
            "RS Smart 130": {
                w: [100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350],
                h: [100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350,360,370,380,390,400,410,420,430,440,450,460,470,480,490,500],
                prices: [
                    [3166,3260,3323,3418,3512,3591,3654,3733,3812,3875,3953,4048,4142,4190,4284,4394,4505,4631,4678,4772,4851,5072,5235,5324,5355,5475], // 100
                    [3308,3402,3465,3591,3654,3733,3812,3875,3969,4079,4158,4221,4331,4394,4489,4599,4725,4851,4914,4993,5119,5182,5370,5418,5355,5460], // 110
                    [3434,3528,3638,3686,3812,3875,3969,4079,4174,4253,4331,4426,4489,4631,4709,4820,4946,5119,5166,5292,5371,5324,5610,5544,5550,5685], // 120
                    [3591,3670,3764,3843,3953,4048,4158,4253,4331,4426,4536,4631,4709,4835,4898,5024,5150,5324,5418,5513,5607,5434,5865,5670,5855,6075], // 130
                    [3686,3812,3906,4016,4095,4190,4316,4394,4489,4631,4709,4835,4914,5009,5119,5245,5387,5576,5670,5765,5891,5544,6135,5780,6165,6300], // 140
                    [3827,3922,4048,4158,4253,4347,4473,4568,4678,4820,4898,4993,5119,5166,5339,5465,5576,5780,5906,6001,6127,5670,6390,5906,6570,6705], // 150
                    [3953,4079,4190,4316,4394,4536,4646,4725,4883,4977,5072,5198,5324,5355,5528,5670,5780,6048,6158,6237,6379,5765,6615,6048,6750,6870], // 160
                    [4095,4190,4331,4457,4552,4678,4820,4914,5009,5150,5292,5402,5513,5513,5733,5875,6032,6284,6395,6536,6631,5906,6900,6158,6960,7125], // 170
                    [4221,4347,4457,4568,4709,4851,4977,5072,5198,5339,5481,5607,5702,5670,5954,6080,6221,6410,6615,6773,6899,6032,7095,6284,7335,7500], // 180
                    [4347,4473,4631,4725,4883,4993,5135,5245,5402,5513,5654,5765,5906,5812,6158,6300,6442,6804,6820,7025,7166,6158,7320,6410,7560,7770], // 190
                    [4473,4631,4725,4898,5009,5150,5292,5465,5576,5702,5828,5954,6127,6001,6347,6521,6678,6615,7040,7261,7434,6237,7605,6536,7570,8085], // 200
                    [4631,4725,4898,5009,5166,5324,5481,5607,5733,5891,6001,6174,6284,6158,6552,6725,6867,7198,7245,7466,7655,6395,7860,6678,7950,8340], // 210
                    [4725,4898,5009,5166,5339,5481,5639,5765,5906,6064,6221,6363,6521,6300,6757,6930,7103,7135,7434,7670,7938,6505,8130,6773,8160,8655], // 220
                    [4883,5009,5166,5339,5497,5639,5765,5938,6111,6237,6395,6552,6725,6647,6962,7135,7308,7513,7623,7891,8174,6631,8370,6914,8505,8925], // 230
                    [4993,5292,5481,5481,5639,5954,5954,6127,6442,6426,6568,6946,7103,6473,7166,7340,7513,7466,7970,8159,8442,6725,8610,7025,8730,9165], // 240
                    [5135,5150,5324,5639,5765,5780,6127,6269,6269,6615,6773,6741,6899,6804,7387,7576,7749,7639,8127,8363,8694,6867,8820,7151,8985,9360], // 250
                    [5245,5575,5607,5765,6111,6269,6269,6615,6615,6962,7166,7340,7308,6962,7592,7781,7954,7985,8363,8615,8930,6962,9090,7277,9195,9630], // 260
                    [5402,5455,5733,5905,5938,6127,6442,6442,6788,6788,6962,7135,7497,7135,7796,7985,8159,8143,8552,8789,9214,7119,9300,7403,9435,9855], // 270
                    [5513,5702,5891,6064,6237,6426,6615,6788,6962,7166,7340,7513,7718,7324,7970,8190,8379,8285,8726,8993,9419,7198,9615,7481,9675,10215], // 280
                    [5654,5828,6001,6221,6395,6568,6773,6962,7166,7340,7513,7733,7938,7466,8143,8415,8804,8442,8930,9245,9734,7340,9840,7639,9990,10455], // 290
                    [6048,6694,7308,6788,7733,6741,8054,8001,7844,8993,9419,9655,10379,7607,10206,10631,10442,8442,9104,9482,9938,7434,10065,7749,10260,10680], // 300
                    [6552,7607,7450,7560,6552,6899,7103,7655,7497,9655,9623,9860,9923,7844,10663,10785,10600,8600,9371,9671,10206,7592,10365,7922,10500,11025], // 310
                    [7387,5954,7166,6946,8017,7056,7261,8332,8206,9340,9923,10175,10159,8096,10899,11010,10789,8710,9655,9860,10395,7655,10545,7985,10830,11145], // 320
                    [6710,6521,7922,7103,8379,7229,7450,8489,8379,9151,9245,9482,9734,8379,11135,11235,10710,8867,9702,9907,10584,7828,10845,8237,10950,11505], // 330
                    [6426,7372,7025,7261,7592,7403,7592,7466,8600,8789,9072,9277,9513,8631,11403,11490,10915,9025,9891,10238,10631,7985,11070,8411,11265,11730], // 340
                    [6284,6788,6883,7434,7450,7544,7765,7308,8773,8515,8852,9072,9324,8946,10206,11685,11135,9167,10017,10537,10899,8111,11295,8474,11520,11970], // 350
                    [6174,6127,6741,6694,7308,7718,7938,7135,8962,8442,8694,8852,9104,9167,9182,11910,11088,9308,10206,10868,11135,8363,11610,8647,11745,12330], // 360
                    [5906,6237,6568,6521,7166,7844,6946,8663,9119,8253,8489,8694,8867,9308,9403,11576,11009,9450,10505,11151,11403,8631,11835,8710,12060,12555], // 370
                    [5765,6379,6442,6363,7025,8017,8206,8820,9371,8064,8285,8505,8694,9308,9655,11277,11198,9576,10521,11482,11624,8867,12060,8883,12405,12795], // 380
                    [6946,6946,6284,8127,6883,8174,8363,9135,7340,7859,8096,8285,8505,9450,9749,11482,11356,9828,10726,11781,11891,9025,12360,8978,12585,13065], // 390
                    [7056,7056,6174,7859,6725,8332,8521,7796,7670,7718,7938,8096,8285,9623,9875,11850,11293,10064,10789,12112,12128,9167,12735,9135,12945,13335]  // 400
                ]
            }
        };

        // State
        let currentVendor = "screen_2025";
        let currentCalculation = null; // Sparar senaste uträkningen
        let quoteItems = [];
        
        // DOM Elements
        const el = {
            vendorRadios: document.querySelectorAll('input[name="vendor"]'),
            catSelect: document.getElementById('category'),
            prodSelect: document.getElementById('product'),
            wInput: document.getElementById('width'),
            hInput: document.getElementById('height'),
            calcBtn: document.getElementById('calculate-btn'),
            addPanel: document.getElementById('add-panel'),
            displayPrice: document.getElementById('display-price'),
            displayDims: document.getElementById('display-dims'),
            qtyInput: document.getElementById('quantity'),
            addToQuoteBtn: document.getElementById('add-to-quote-btn'),
            quoteContainer: document.getElementById('quote-items'),
            emptyState: document.getElementById('empty-state'),
            totalPrice: document.getElementById('total-price'),
            quoteCount: document.getElementById('quote-count'),
            errorMsg: document.getElementById('error-msg'),
            errorText: document.getElementById('error-text'),
            dimLimits: document.getElementById('dim-limits')
        };

        // --- SETUP ---
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('sv-SE');
        document.getElementById('ref-id').innerText = 'REF-' + Math.floor(1000 + Math.random() * 9000);
        updateCategories();

        // Event Listeners
        el.vendorRadios.forEach(r => r.addEventListener('change', (e) => {
            currentVendor = e.target.value;
            updateCategories();
            resetCalculation();
        }));

        el.catSelect.addEventListener('change', updateProducts);
        
        el.prodSelect.addEventListener('change', () => {
            updateDimLimits();
            resetCalculation();
        });

        el.calcBtn.addEventListener('click', calculatePrice);
        el.addToQuoteBtn.addEventListener('click', addItemToQuote);

        // --- LOGIC ---

        function updateCategories() {
            el.catSelect.innerHTML = '<option value="">-- Välj --</option>';
            el.prodSelect.innerHTML = '<option value="">-- Välj --</option>';
            el.prodSelect.disabled = true;
            el.dimLimits.classList.add('hidden');
            
            const cats = database[currentVendor].categories;
            for(const cat in cats) {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                el.catSelect.appendChild(opt);
            }
        }

        function updateProducts() {
            const cat = el.catSelect.value;
            el.prodSelect.innerHTML = '<option value="">-- Välj --</option>';
            el.dimLimits.classList.add('hidden');
            
            if(cat) {
                el.prodSelect.disabled = false;
                const products = database[currentVendor].categories[cat];
                for(const prod in products) {
                    const opt = document.createElement('option');
                    opt.value = prod;
                    opt.textContent = prod;
                    el.prodSelect.appendChild(opt);
                }
            } else {
                el.prodSelect.disabled = true;
            }
            resetCalculation();
        }

        function updateDimLimits() {
            const cat = el.catSelect.value;
            const prod = el.prodSelect.value;
            if(cat && prod) {
                const data = database[currentVendor].categories[cat][prod];
                el.dimLimits.innerText = `Bredd: ${data.range.minW}-${data.range.maxW} cm | Höjd: ${data.range.minH}-${data.range.maxH} cm`;
                el.dimLimits.classList.remove('hidden');
            }
        }

        function resetCalculation() {
            el.addPanel.classList.add('hidden', 'opacity-0', 'translate-y-4');
            el.addPanel.classList.remove('block', 'opacity-100', 'translate-y-0');
            currentCalculation = null;
            el.errorMsg.classList.add('hidden');
        }

        function calculatePrice() {
            resetCalculation();
            const w = parseFloat(el.wInput.value);
            const h = parseFloat(el.hInput.value);
            const cat = el.catSelect.value;
            const prod = el.prodSelect.value;

            // Validering
            if (!w || !h || !cat || !prod) {
                showError("Fyll i alla fält.");
                return;
            }

            // Hämta produktdata säkert
            const prodData = database[currentVendor]?.categories?.[cat]?.[prod];
            
            if (!prodData) {
                showError("Kunde inte hitta produktdata.");
                return;
            }

            // Kontrollera måttgränser
            if (w < prodData.range.minW || w > prodData.range.maxW) {
                showError(`Ogiltig bredd. Tillåtet: ${prodData.range.minW} - ${prodData.range.maxW} cm`);
                return;
            }
            if (h < prodData.range.minH || h > prodData.range.maxH) {
                showError(`Ogiltig höjd. Tillåtet: ${prodData.range.minH} - ${prodData.range.maxH} cm`);
                return;
            }

            // BERÄKNING
            let unitPrice = 0;
            let unit = database[currentVendor].unit; // "cm" eller "mm"
            let tableW, tableH;

            // Sjekk om vi har en faktisk matrise for dette produktet
            const matrix = priceMatrices[prod];

            if (matrix) {
                // --- MATRISEOPPSLAG (Alternativ A) ---
                
                // 1. Finn nærmeste bredde (oppover)
                // Matrisen bruker samma enhet som unit (cm/mm)
                let wIndex = -1;
                // Om enheten är mm men matrisen är i mm, måste vi matcha inmatat cm mot mm-matrisen
                // C80/F80: unit="mm", matrix="mm". Input w=100 (cm).
                // Om unit="mm", då w*10 för att matcha matrisen
                // Om unit="cm", då w för att matcha matrisen

                let searchW = (unit === "mm") ? w * 10 : w;
                let searchH = (unit === "mm") ? h * 10 : h;

                for (let i = 0; i < matrix.w.length; i++) {
                    if (matrix.w[i] >= searchW) {
                        wIndex = i;
                        tableW = matrix.w[i];
                        break;
                    }
                }

                // 2. Finn nærmeste høyde (oppover)
                let hIndex = -1;
                for (let i = 0; i < matrix.h.length; i++) {
                    if (matrix.h[i] >= searchH) {
                        hIndex = i;
                        tableH = matrix.h[i];
                        break;
                    }
                }

                if (wIndex === -1 || hIndex === -1) {
                    showError("Dimensjonen finnes ikke i pristabellen (utenfor standard).");
                    return;
                }

                // 3. Hent pris
                // Sjekk at raden och kolonnen finnes
                if (matrix.prices[hIndex] && matrix.prices[hIndex][wIndex] !== undefined) {
                    unitPrice = matrix.prices[hIndex][wIndex];
                } else {
                    showError("Prisdata mangler for denne kombinasjonen.");
                    return;
                }

            } else {
                // --- FALLBACK FORMEL (Alternativ B) ---
                // Brukes for produkter vi ikke har lagt inn matrise for enda
                
                let stepsW, stepsH;
                if (unit === "mm") {
                    // Neva Logic (Fallback om vi inte har matrisen för andra Neva-produkter)
                    const startW = (prod.includes("C80")) ? 1000 : 700;
                    // w och h är i cm från input
                    const wMM = w * 10; 
                    const hMM = h * 10;

                    tableW = Math.max(startW, Math.ceil(wMM / 100) * 100);
                    tableH = Math.max(1000, Math.ceil(hMM / 100) * 100);
                    stepsW = (tableW - startW) / 100;
                    stepsH = (tableH - 1000) / 100;
                } else {
                    // Screen Logic (Fallback)
                    const isXL = prod.includes("XL");
                    const startW = isXL ? 610 : 100;
                    const startH = 100;
                    // w och h är i cm
                    tableW = Math.max(startW, Math.ceil(w / 10) * 10);
                    tableH = Math.max(startH, Math.ceil(h / 10) * 10);
                    stepsW = (tableW - startW) / 10;
                    stepsH = (tableH - startH) / 10;
                }

                if (prod.includes("XL")) {
                     unitPrice = prodData.base + (stepsW * 150) + (stepsH * 100);
                } else {
                    const factor = prodData.factor - 1;
                    unitPrice = prodData.base * (1 + (stepsW * factor) + (stepsH * factor));
                }
            }
            
            unitPrice = Math.round(unitPrice);

            // Spara resultatet i minnet
            currentCalculation = {
                product: prod,
                category: cat,
                vendor: database[currentVendor].name,
                width: w,
                height: h,
                tableW: tableW,
                tableH: tableH,
                unit: unit,
                price: unitPrice
            };

            // Visa i UI
            el.displayPrice.innerText = unitPrice.toLocaleString('no-NO');
            el.displayDims.innerText = `${tableW} x ${tableH} ${unit}`;
            
            // Animera fram panelen
            el.addPanel.classList.remove('hidden');
            setTimeout(() => {
                el.addPanel.classList.remove('opacity-0', 'translate-y-4');
                el.addPanel.classList.add('opacity-100', 'translate-y-0');
            }, 10);
        }

        function addItemToQuote() {
            if (!currentCalculation) return;

            const qty = parseInt(el.qtyInput.value) || 1;
            const totalPrice = currentCalculation.price * qty;

            const item = {
                id: Date.now(), // Unikt ID
                ...currentCalculation,
                qty: qty,
                total: totalPrice
            };

            quoteItems.push(item);
            renderQuote();
            
            // Återställ för nästa inmatning
            resetCalculation();
            el.wInput.value = '';
            el.hInput.value = '';
            el.qtyInput.value = '1';
        }

        function renderQuote() {
            el.quoteContainer.innerHTML = '';
            let grandTotal = 0;

            if (quoteItems.length === 0) {
                el.emptyState.style.display = 'flex';
            } else {
                el.emptyState.style.display = 'none';
                
                quoteItems.forEach(item => {
                    grandTotal += item.total;
                    
                    const row = document.createElement('div');
                    row.className = "grid grid-cols-12 gap-2 px-6 py-3 border-b border-slate-100 items-center hover:bg-slate-50 transition text-sm fade-in";
                    row.innerHTML = `
                        <div class="col-span-5">
                            <p class="font-bold text-slate-800">${item.product}</p>
                            <p class="text-[10px] text-slate-500 uppercase tracking-wide">${item.vendor} • ${item.category}</p>
                        </div>
                        <div class="col-span-2 text-center font-mono text-slate-600">
                            ${item.width} x ${item.height}
                        </div>
                        <div class="col-span-2 text-center">
                            <span class="bg-slate-100 text-slate-700 px-2 py-0.5 rounded text-xs font-bold border border-slate-200">${item.qty}</span>
                        </div>
                        <div class="col-span-2 text-right font-bold text-slate-800">
                            ${item.total.toLocaleString('no-NO')}
                        </div>
                        <div class="col-span-1 text-right no-print">
                            <button onclick="removeItem(${item.id})" class="text-slate-300 hover:text-red-500 transition p-1">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                    `;
                    el.quoteContainer.appendChild(row);
                });
            }

            el.totalPrice.innerText = grandTotal.toLocaleString('no-NO') + " NOK";
            el.quoteCount.innerText = `${quoteItems.length} artiklar`;
        }

        function removeItem(id) {
            quoteItems = quoteItems.filter(item => item.id !== id);
            renderQuote();
        }

        function clearQuote() {
            if(quoteItems.length > 0 && confirm("Rensa hela offerten?")) {
                quoteItems = [];
                renderQuote();
            }
        }

        function changeQty(delta) {
            let val = parseInt(el.qtyInput.value) || 1;
            val += delta;
            if(val < 1) val = 1;
            el.qtyInput.value = val;
        }

        function showError(msg) {
            el.errorText.textContent = msg;
            el.errorMsg.classList.remove('hidden');
            setTimeout(() => el.errorMsg.classList.add('hidden'), 4000);
        }

        // --- AI Logic ---
        const aiInput = document.getElementById('ai-input');
        const aiResponse = document.getElementById('ai-response');

        window.fillPrompt = (txt) => {
            aiInput.value = txt;
        };

        async function handleChat() {
            const txt = aiInput.value.trim().toLowerCase();
            if (!txt) return;

            aiResponse.innerHTML = '<i class="fa-solid fa-spinner fa-spin text-indigo-500"></i> Tänker...';
            aiResponse.classList.remove('hidden');

            setTimeout(() => {
                let ans = "Jag är inte säker. Försök fråga om en specifik modell.";
                
                if(txt.includes("xl")) ans = "<strong>RS Smart 130 XL</strong> är för stora bredder (upp till 600 cm). Den kräver oftast motorstyrning på minst 20 Nm pga vikten.";
                else if(txt.includes("zip")) ans = "<strong>Mini ZIP</strong> är mycket vindtålig tack vare låsning i sidoskenorna. Kassetten är endast 75mm hög.";
                else if(txt.includes("c80")) ans = "<strong>C80</strong> (Neva) är en robust utv. persienn med falsade lameller för extra stabilitet i vind.";
                else if(txt.includes("universal")) ans = "<strong>RS Universal</strong> har unika tvådelade styrskenor (UTG) som döljer infästningen, perfekt för nischer.";
                
                aiResponse.innerHTML = ans;
            }, 600);
        }
    </script>
</body>
</html>
